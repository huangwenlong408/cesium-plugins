class t{constructor(t,e){this.Cesium=t,this.viewer=e,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.canvas)}pick(t,e=!0){const i=this.Cesium,s=this.viewer;this.handler.setInputAction((o=>{const n=s.scene.globe.pick(s.camera.getPickRay(o.position),s.scene);if(n){const o=s.scene.globe.ellipsoid.cartesianToCartographic(n),r=i.Math.toDegrees(o.latitude),a=i.Math.toDegrees(o.longitude),l=o.height;e&&function(t,e="14px",i="#292421",s="#B6D5F1"){let o="";if(Array.isArray(t)){for(let e=0;e<t.length;e++)o+=t[e]+"\n";o=o.slice(0,o.length-1)}else o=t;console.log(`%c${o}`,`font-size: ${e}; background: ${s}; color: ${i}; padding: 4px 8px; border-radius: 5px; margin: 1px 0px;`)}([`lon: ${a}`,`lat: ${r}`,`hgt: ${l}`]),"function"==typeof t&&t({lon:a,lat:r,hgt:l})}}),i.ScreenSpaceEventType.LEFT_CLICK)}destroy(){this.handler=this.handler&&this.handler.destroy()}disable(){const t=this.Cesium;this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)}}class e{constructor(t,e){this.Cesium=t,this.viewer=e,this.tileset=null}load(t,e,i={}){const s=this.Cesium,o=this.viewer;return e=Object.assign({lon:116.391311,lat:39.90616,hgt:0,rx:0,ry:0,rz:0,scale:1},e),i=Object.assign(i,{url:t}),this.tileset=o.scene.primitives.add(new s.Cesium3DTileset(i)),this.tileset.readyPromise.then((()=>{const t=s.Cartesian3.fromDegrees(e.lon,e.lat,e.hgt),i=s.Transforms.eastNorthUpToFixedFrame(t),o=s.Matrix4.fromUniformScale(e.scale),n=s.Matrix3.fromRotationX(s.Math.toRadians(e.rx)),r=s.Matrix3.fromRotationY(s.Math.toRadians(e.ry)),a=s.Matrix3.fromRotationZ(s.Math.toRadians(e.rz)),l=s.Matrix4.fromRotationTranslation(n),h=s.Matrix4.fromRotationTranslation(r),c=s.Matrix4.fromRotationTranslation(a);s.Matrix4.multiply(i,o,i),s.Matrix4.multiply(i,l,i),s.Matrix4.multiply(i,h,i),s.Matrix4.multiply(i,c,i),this.tileset._root.transform=i})),this.tileset}locate(){this.viewer.zoomTo(this.tileset)}destroy(){this.tileset=this.tileset&&this.tileset.destroy()}}class i{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.container=null,this.inner=null,this.isShow=!0,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.canvas),this.init(i,s)}init(t,e){const i=this.Cesium,s=this.viewer,o={offset:{left:30,top:50},containerStyle:{display:"block",position:"absolute",maxWidth:"150px",minWidth:"100px",borderRadius:"4px",background:"#757575",color:"#fafafa",zIndex:"999"},innerStyle:{padding:"5px 8px",fontSize:"10px",fontWeight:"400"},isShowOnlyOnEarth:!0};Object.keys(o).forEach((t=>{"object"==typeof o[t]?Object.assign(o[t],e[t]):o[t]=e[t]})),this.container=document.createElement("div"),this.inner=document.createElement("div"),this.inner.innerHTML=t,Object.assign(this.container.style,o.containerStyle),Object.assign(this.inner.style,o.innerStyle),this.container.appendChild(this.inner),this.viewer.cesiumWidget.container.appendChild(this.container),this.handler.setInputAction((t=>{const e=s.camera.pickEllipsoid(t.endPosition,s.scene.globe.ellipsoid);this.isShow&&(e&&o.isShowOnlyOnEarth||!o.isShowOnlyOnEarth?(this.container.style.display="block",this.setPosition(t.endPosition,o.offset)):this.container.style.display="none")}),i.ScreenSpaceEventType.MOUSE_MOVE)}setPosition(t,e){this.container.style.left=t.x+e.left+"px",this.container.style.top=t.y-this.container.clientHeight/2+e.top+"px"}show(){this.isShow=!0,this.container.style.display="block"}hide(){this.isShow=!1,this.container.style.display="none"}destroy(){this.viewer.cesiumWidget.container.removeChild(this.container),this.handler=this.handler&&this.handler.destroy()}}function s(t,e){t.render();let i=t.scene.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),s=document.createElement("a"),o=function(t){let e=t.split(","),i=e[0].match(/:(.*?);/)[1],s=atob(e[1]),o=s.length,n=new Uint8Array(o);for(;o--;)n[o]=s.charCodeAt(o);return new Blob([n],{type:i})}(i),n=URL.createObjectURL(o);s.download=e?`${e}.png`:`Scene-${(new Date).getTime()}.png`,s.href=n,s.click()}class o{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.pos=i,this.waterPolygon=null,this.defaultFloodOpts=null,this.floodOpts=s,this.initOpts()}initOpts(){this.defaultFloodOpts=Object.assign({waterHeight:0,targetWaterHeight:100,speed:1,waterColor:new Cesium.Color.fromBytes(64,157,250,120)},this.floodOpts)}startCallbackProperty(t){return new this.Cesium.CallbackProperty((()=>(this.defaultFloodOpts.waterHeight+=this.defaultFloodOpts.speed,this.defaultFloodOpts.waterHeight>this.defaultFloodOpts.targetWaterHeight?this.defaultFloodOpts.waterHeight=this.defaultFloodOpts.targetWaterHeight:t(this.defaultFloodOpts.waterHeight),this.defaultFloodOpts.waterHeight)),!1)}getCurrentWaterHeight(){return this.defaultFloodOpts.waterHeight}setCurrentWaterHeight(t){this.waterPolygon.polygon.extrudedHeight=new Cesium.CallbackProperty((()=>t),!1)}start(t){const e=this.Cesium,i=this.viewer;this.waterPolygon?this.waterPolygon.polygon.extrudedHeight=this.startCallbackProperty(t):this.waterPolygon=i.entities.add({polygon:{hierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArray(this.pos)),perPositionHeight:!0,extrudedHeight:this.startCallbackProperty(t),material:this.defaultFloodOpts.waterColor}})}pause(){const t=this.Cesium;this.waterPolygon.polygon.extrudedHeight=new t.CallbackProperty((()=>this.defaultFloodOpts.waterHeight),!1)}destroy(){this.viewer.entities.remove(this.waterPolygon),this.waterPolygon=null,this.initOpts()}}export{e as Cesium3DTilesLoader,o as FloodAnalysis,t as PositionPicker,i as Tooltip,s as exportSceneAsImage};
